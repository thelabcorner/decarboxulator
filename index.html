<!DOCTYPE html>
<html lang="en-US">
<head>
    <title>Decarboxulator&#x2122; | TheLabCorner LLC</title>
    <link rel="manifest" href="manifest.json">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@600&display=swap" rel="stylesheet">

    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" sizes="32x32 64x64 48x48 16x16 128x128 512x512" href="icons/favicon.ico">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Decarboxulator">
    <meta name="apple-mobile-web-app-title" content="Decarboxulator">
    <meta name="theme-color" content="#ffbd00">
    <meta name="msapplication-navbutton-color" content="#ffbd00">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-starturl" content="/">


    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, shrink-to-fit=no">

    <link href="mobile.css" rel="stylesheet" type="text/css">


    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</head>

<body>

<div id="splash-screen">
    <div id="logo-container">
        <img id="logo" src="icons/decarboxulator.svg" alt="Decarboxulator">
    </div>

    <script>

        window.addEventListener('load', function() {
        var screenWidth = window.innerWidth;
        var screenHeight = window.innerHeight;
        var logo = document.getElementById('logo');
        var logoWidth = logo.getBBox().width;
        var logoHeight = logo.getBBox().height;
        var logoRatio = logoWidth / logoHeight;
        var container = document.getElementById('logo-container');
        var containerWidth, containerHeight;
        if (screenWidth / screenHeight > logoRatio) {
            containerWidth = screenHeight * logoRatio;
            containerHeight = screenHeight;
        } else {
            containerWidth = screenWidth;
            containerHeight = screenWidth / logoRatio;
        }
        container.style.width = containerWidth + 'px';
        container.style.height = containerHeight + 'px';

        const duration = Math.floor(Math.random() * (3220 - 140) + 140) / 1000;

        document.getElementById('splash-screen').style.animationDuration = duration + 's';
            console.log('Splash screen duration: ' + duration.toFixed(2) + 's');
    });

        var splashScreen = document.getElementById('splash-screen');
        splashScreen.addEventListener('animationend', function() {
            splashScreen.remove();
        });


    </script>

</div>

<div class="tab">
    <button class="tablinks" onclick="openTab(event, 'thcaToThc')">THCa Decarboxylation Yield Calculator</button>
    <button class="tablinks" onclick="openTab(event, 'thcToThca')">THCa Input Finder</button>
    <button class="tablinks" onclick="openTab(event, 'decarbProgress')">Decarboxylation Progress Tracker</button>
    <button class="tablinks" onclick="openTab(event, 'decarbTime')">Total Decarboxylation Time Predictor</button>
    <button class="tablinks" onclick="openTab(event, 'cartridgeIsolateCalculator')">Cartridge Isolate Calculator</button>
</div>

<div id="thcaToThc" class="tabcontent">
    <h2>THCa to THC Decarboxylation Yield Calculator</h2>
    <form id="thcaToThcForm">
        <label for="thcaWeight">Weight of THCa (grams):</label>
        <input type="number" pattern="[0-9]*\.?[0-9]*" placeholder="34.2 grams" id="thcaWeight" name="thcaWeight" required oninput="calculateThcaToThc()">
        <button type="button" onclick="calculateThcaToThc()">Calculate</button>
    </form>

    <div id="thcaToThcResult"></div>
    <br><hr id="YieldSeparator">
    <div id="decarbYieldDescription">
        <button class="spoiler-btn" onclick="toggleSpoiler('dcYieldInstructions')"><b>Instructions:</b></button>
        <div id="dcYieldInstructions" class="spoiler-content">
            <p>To use the THCa to THC Decarboxylation Yield Calculator, follow these simple steps:</p>
            <ol>
                <li>Enter the weight of THCa in grams in the &quot;Weight of&quot;THCa&quot; field of the form.</li>
                <li>Click on the &quot;Calc&quot;late&quot; button to generate the result.</li>
                <li>The estimated yield of THC produced and the estimated CO2 loss will be displayed below the form.</li>
            </ol>
            <p>Please enter a positive value between 0.1 and 10 billion in the &quot;Weight of&quot;THCa&quot; field. Any value outside this range will result in an error message.</p>
        </div>
        <br>
        <button class="spoiler-btn" onclick="toggleSpoiler('dcYieldCalculations')"><b>Formula(s) Used:</b></button>
        <div id="dcYieldCalculations" class="spoiler-content">
            <p>
                <math>
                    <mi>THC weight</mi>
                    <mo>=</mo>
                    <mrow>
                        <mi>THCa weight</mi>
                        <mo>&times;</mo>
                        <mfrac>
                            <mrow>
                                <mn>314.47</mn>
                            </mrow>
                            <mrow>
                                <mn>358.48</mn>
                            </mrow>
                        </mfrac>
                    </mrow>
                </math>
            </p>
            <p>
                <math>
                    <mi>CO2 loss</mi>
                    <mo>=</mo>
                    <mrow>
                        <mi>THCa weight</mi>
                        <mo>-</mo>
                        <mi>THC weight</mi>
                    </mrow>
                </math>
            </p>
        </div><br>
    </div>

    </div>

<script>
    function toggleSpoiler(spoilerId) {
        const spoilerContent = document.getElementById(spoilerId);
        if (spoilerContent.style.maxHeight) {
            spoilerContent.style.maxHeight = null;
        } else {
            spoilerContent.style.maxHeight = spoilerContent.scrollHeight + "px";
        }
    }
</script>

<audio id="audio" src="egg.mp3"></audio>

<script>

    function easterEgg() {
        const audio = document.getElementById('audio');
        audio.volume = 1; // Set volume to 50%
        audio.play();
        fadeOut();

        // Define a function to gradually decrease the volume of the audio clip
        function fadeOut() {
            const fadeInterval = 50; // Time interval between volume changes (ms)
            const clipDuration = audio.duration * 1000; // Duration of the clip in milliseconds
            const fadeStart = clipDuration * 0.75; // Point at which the fade-out should start
            const fadeDuration = clipDuration - fadeStart; // Duration of the fade-out (ms)
            const fadeSteps = fadeDuration / fadeInterval; // Number of volume changes
            const fadeAmount = audio.volume / fadeSteps; // Amount to decrease volume by each step
            let step = 0;

            const fadeIntervalId = setInterval(() => {
                if (!audio.paused) {
                    step++;
                    audio.volume -= fadeAmount;
                    if (audio.volume < 0) {
                        audio.volume = 0;
                    }
                    if (step >= fadeSteps) {
                        clearInterval(fadeIntervalId);
                        audio.pause();
                    }
                } else {
                    clearInterval(fadeIntervalId);
                }
            }, fadeInterval);
        }
    }



    function calculateThcaToThc() {
        const thcaWeight = document.getElementById("thcaWeight").valueAsNumber;
        const thcWeight = thcaWeight * (314.47 / 358.48);
        const lossCalc = (thcaWeight - thcWeight);

        const formatTHCOut = thcWeight.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        const formatLossOut = lossCalc.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        if (isNaN(thcaWeight) || thcaWeight < 0.0000000000000000000000001 || thcaWeight > 9999999999.9999999999) {
            document.getElementById("thcaToThcResult").innerHTML = "<br><br><span style='color: red'><b>Error: Invalid input value(s)<br>Note: Please enter a positive value between 0.1 and 10 billion.</b></span><br>";
        } else {
            if (thcaWeight === 69420 || thcaWeight === 42069 || thcaWeight === 420 || thcaWeight === 710) {
                easterEgg()
                document.getElementById("thcaToThcResult").innerHTML = "<br><b>Estimated CO2 Loss: </b><br>" + formatLossOut + " grams" + "<br><br><b>Estimated THC produced: </b><br>" + formatTHCOut + " grams";
            } else {
            document.getElementById("thcaToThcResult").innerHTML = "<br><b>Estimated CO2 Loss: </b><br>" + formatLossOut + " grams" + "<br><br><b>Estimated THC produced: </b><br>" + formatTHCOut + " grams";
            }
        }
    }
</script>


<!-- THCA Input Finder - How much THCa to make X grams THC -->
<div id="thcToThca" class="tabcontent">
    <h2>THCa Input Finder</h2>
    <form id="thcToThcaForm">
        <label for="thcWeight">Desired Weight of THC (grams):</label>
        <input type="number" pattern="[0-9]*\.?[0-9]*" placeholder="67 grams" id="thcWeight" name="thcWeight" max="9999999999" required oninput="calculateThcToThca()">
        <button type="button" onclick="calculateThcToThca()">Calculate</button>
    </form>
    <div id="thcToThcaResult"></div>
    <br>
    <hr id="finderSeparator">
    <div id="inputFinderDescription">
        <button class="spoiler-btn" onclick="toggleSpoiler('inputFinderInstructions')"><b>Instructions:</b></button>
        <div id="inputFinderInstructions" class="spoiler-content">
            <p><em>Instructions:</em></p>
            <ol>
                <li>Input the weight of THC you want to produce in grams into the designated field.</li>
                <li>Click on the &quot;Calc&quot;late&quot; button to generate the result.</li>
                <li>The estimated weight of THCA required to produce the desired weight of THC will be displayed below the form.</li>
            </ol>
        </div>
        <br>
        <button class="spoiler-btn" onclick="toggleSpoiler('inputFinderCalculations')"><b>Formula(s) Used:</b></button>
        <div id="inputFinderCalculations" class="spoiler-content">
            <br>
            <math>
                <mrow>
                    <mi>THCA Needed</mi>
                    <mo>=</mo>
                    <mfrac>
                        <mrow>
                            <mi>THC Desired</mi>
                        </mrow>
                        <mrow>
                            <mo>(</mo>
                            <mfrac>
                                <mrow>
                                    <mn>314.47</mn>
                                </mrow>
                                <mrow>
                                    <mn>358.48</mn>
                                </mrow>
                            </mfrac>
                            <mo>)</mo>
                        </mrow>
                    </mfrac>
                </mrow>
            </math>

        </div><br>
    </div>
</div>

<script>
    function calculateThcToThca() {
        const thcWeight = document.getElementById("thcWeight").valueAsNumber;
        const thcaWeight = thcWeight / (314.47 / 358.48);
        const formattedOutput = thcaWeight.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        if (isNaN(thcWeight) || thcWeight < 0.0000000000000000000000001 || thcWeight > 9999999999.9999999999) {
            document.getElementById("thcToThcaResult").innerHTML = "<br><br><span style='color: red'><b>Error: Invalid input value(s)<br>Note: Please enter a positive value between 0.1 and 10 billion.</b></span><br>";
        } else {
            document.getElementById("thcToThcaResult").innerHTML = "<br><br><b>THCa required: </b><br>" + formattedOutput + " grams";
        }
    }
</script>

<div id="decarbProgress" class="tabcontent">
    <div id="decarbProgressCalc">
        <h2>Decarboxylation Progress Tracker</h2>
        <form id="decarbProgressForm">
            <label for="thcaStartWeight">Input Weight of THCa (grams):</label>
            <input type="number" pattern="[0-9]*" id="thcaStartWeight" name="thcaStartWeight" placeholder="114 grams" required oninput="calculateDecarbProgress()">
            <label for="thcDecarbedWeight">Current Weight of THCa (grams):</label>
            <input type="number" pattern="[0-9]*" id="thcDecarbedWeight" name="thcDecarbedWeight" placeholder="100 grams" required oninput="calculateDecarbProgress()">
            <button type="button" onclick="calculateDecarbProgress()">Calculate</button>
        </form>
        <div id="decarbProgressResult"></div>


        <br><hr id="progressSeparator">

        <div id="progressDescription">
            <button class="spoiler-btn" onclick="toggleSpoiler('progressInstructions')"><b>Instructions:</b></button>
            <div id="progressInstructions" class="spoiler-content">
                <p>To use the tool, follow these steps:</p>
                <ol>
                    <li>Enter the starting weight of THCA (in grams) in the &quot;Input Weight of&quot;THCa&quot; field.</li>
                    <li>Enter the current weight of decarboxylated material (in grams) in the &quot;Current Weight of&quot;THCa&quot; field.</li>
                    <li>Click the &quot;Calculate&quot; button to generate the results.</li>
                </ol>
                <p>The tool will utilize a specialized formula to estimate the predicted weight of decarboxylated material and the percentage of decarboxylation progress. The formula assumes complete decarboxylation and may be affected by factors such as temperature, time, and the starting material. As such, the estimates should be used as guidance rather than concrete values.</p>
                <p>If there are any errors in the input values, such as negative values or empty fields, an error message will be displayed.</p>
            </div>
            <br>
            <button class="spoiler-btn" onclick="toggleSpoiler('progressCalculations')"><b>Formula(s) Used:</b></button>
            <div id="progressCalculations" class="spoiler-content">
                <br>
                <p><b><u>Main Formula:</u></b></p>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <mtext>Percent Decarboxylation Progress = </mtext>
                    <mo>(</mo>
                    <mo>(</mo>
                    <mfrac>
                        <mrow>
                            <mi>Decarboxylated Weight</mi>
                        </mrow>
                        <mrow>
                            <mrow>
                                <mi>Input Weight</mi>
                                <mo>-</mo>
                                <mi>Loss Calculation</mi>
                            </mrow>
                        </mrow>
                    </mfrac>
                    <mo>)</mo>
                    <mo>*</mo>
                    <mn>100</mn>
                    <mo>)</mo>
                </math>
                <hr>
                <p><u><b>Decarboxylated Weight:</b></u></p>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <mi>Decarboxylated Weight</mi>
                    <mo>= </mo>
                    <mi>Input Weight</mi>
                    <mo>-</mo>
                    <mi>Current Weight</mi>
                </math>
                <hr>
                <p><u><b>Loss Calculation:</b></u></p>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <mi>Loss Calculation</mi>
                    <mo>=</mo>
                    <mi>Input Weight</mi>
                    <mo>*</mo>
                    <mn>0.877</mn>
                </math>
                <hr>
                <p><u><b>Predicted Decarboxylated Weight:</b></u></p>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <mtext>Predicted Decarboxylated Weight</mtext>
                    <mo>=</mo>
                    <mi>Input Weight</mi>
                    <mo>*</mo>
                    <mn>0.877</mn>
                </math>
                <hr>
                <p><b><u>Estimated THCa Remaining:</u></b></p>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <mtext>Estimated THCa Remaining</mtext>
                    <mo>=</mo>
                    <mo>(</mo>
                    <mi>Input Weight</mi>
                    <mo>-</mo>
                    <mi>Loss Calculation</mi>
                    <mo>)</mo>
                    <mo>-</mo>
                    <mi>Decarboxylated Weight</mi>
                </math>
            </div><br>
        </div>
    </div>
</div>

<script>
    function calculateDecarbProgress() {
        const InputWeight = document.getElementById("thcaStartWeight").value;
        const CurrentWeight = document.getElementById("thcDecarbedWeight").value;
        const LossCalc = InputWeight * 0.877;
        const DecarbedWeight = InputWeight - CurrentWeight;
        const WeightLeft = (InputWeight - LossCalc) - DecarbedWeight;
        const PercentDecarbed = (DecarbedWeight / (InputWeight - LossCalc)) * 100;


        const formatWeightLeft = WeightLeft.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        const formatLossCalc = LossCalc.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });


        if (PercentDecarbed < -50 || PercentDecarbed > 150 || InputWeight === "" || CurrentWeight === "" || (InputWeight === "0" && CurrentWeight === "0")) {
            document.getElementById("decarbProgressResult").innerHTML = "<br><br><span style='color: red'><b>Error: Invalid input values.</span><br>Note: Please enter realistic, positive values between 0.1 and 10 billion.</b><br>";
        } else {
            if (PercentDecarbed < -0.001 || PercentDecarbed > 100) {
                document.getElementById("decarbProgressResult").innerHTML = "<br><br><span style='color: orange'><b>Warning: Possible Invalid input values<br>Note: This calculator is designed to pinpoint progress from on a scale of 0-100% completion. The following results are likely inaccurate or impossible.</span></b><br><br><b>Predicted Decarboxylated Weight: </b><br>" + formatLossCalc + " grams" +

                    "<br><br><b>Estimated Decarboxylation Progress: </b><br>" + PercentDecarbed.toFixed(2) + "%" +

                    "<br><br><b>Estimated Decarboxylation Progress Remaining: </b><br>" + (100 - PercentDecarbed).toFixed(2) + "%" +

                    "<br><br><b>Estimated THCa Remaining: </b><br>" + formatWeightLeft + " grams" + "<br>";

            } else {
                if ((100 - PercentDecarbed) === 0 ) {
                    document.getElementById("decarbProgressResult").innerHTML = "<br><br><span style='color: limegreen'><b>Complete: Input values indicate decarboxylation has completed.</span></b><br><br><b>Predicted Decarboxylated Weight: </b><br>" + formatLossCalc + " grams" +

                        "<br><br><b>Estimated Decarboxylation Progress: </b><br>" + PercentDecarbed.toFixed(2) + "%" +

                        "<br><br><b>Estimated Decarboxylation Progress Remaining: </b><br>" + (100 - PercentDecarbed).toFixed(2) + "%" +

                        "<br><br><b>Estimated THCa Remaining: </b><br>" + formatWeightLeft + " grams" + "<br>";

                } else {
                document.getElementById("decarbProgressResult").innerHTML =
                    "<br><br><b>Predicted Decarboxylated Weight: </b><br>" + formatLossCalc + " grams" +

                    "<br><br><b>Estimated Decarboxylation Progress: </b><br>" + PercentDecarbed.toFixed(2) + "%" +

                    "<br><br><b>Estimated Decarboxylation Progress Remaining: </b><br>" + (100 - PercentDecarbed).toFixed(2) + "%" +

                    "<br><br><b>Estimated THCa Remaining: </b><br>" + formatWeightLeft + " grams" + "<br>";}
            }
        }
    }
</script>







<div id="decarbTime" class="tabcontent">
    <div id="decarbTimeCalc">
        <h2>THCa Decarboxylation Time Calculator</h2>

        <h2 style="color:red">THIS CALCULATOR IS A WORK IN PROGRESS - IT IS CURRENTLY NONFUNCTIONAL</h2>
        <form id="decarbTimeForm">

            <label for="sampleSize">Sample Size (grams):</label>
            <input type="number" pattern="[0-9]*" id="sampleSize" name="sampleSize" placeholder="10 grams" required>

            <label for="thcaConcentration">THCa Concentration:</label>
            <input type="number" pattern="[0-9]*" id="thcaConcentration" name="percentDecarboxylation" placeholder="67.43%" min="0.01" max="99.99">

            <label for="percentDecarboxylation">Percent Decarboxylation:</label>
            <input type="number" pattern="[0-9]*" id="percentDecarboxylation" name="percentDecarboxylation" placeholder="80" min="1" max="100" required>

            <label for="tempUnit">Temperature Unit:</label>
            <select id="tempUnit" name="tempUnit" required>
                <option value="C">Celsius (&#176;C)</option>
                <option value="F">Fahrenheit (&#176;F)</option>
                <option value="K">Kelvin (K)</option>
            </select>

            <label for="temperature">Temperature:</label>
            <input type="number" pattern="[0-9]*" min="80" max="1000" step="any" id="temperature" name="temperature" placeholder="200&#176" required>

            <br><br>

            <button type="button" onclick="calculateDecarbTime()">Calculate</button>

        </form>
        <div id="decarbTimeResult"></div>
        <br>
        <div id="timeDescription">
            <button class="spoiler-btn" onclick="toggleSpoiler('timeInstructions')"><b>Instructions:</b></button>
            <div id="timeInstructions" class="spoiler-content">
                <p>This tool estimates the time required to decarboxylate a sample of THCa (tetrahydrocannabinolic acid) to &#8710;9-THC (tetrahydrocannabinol) based on the sample size, desired percent decarboxylation, and decarboxylation temperature.</p>

                <p>To use this tool, follow these steps:</p>
                <ol>
                    <li>Enter the sample size (in grams) in the &quot;Sample&quot;Size&quot; field.</li>
                    <li>Enter the desired percent decarboxylation (up to 99.9%) in the &quot;Percent Decarboxyl&quot;tion&quot; field.</li>
                    <li>Enter the decarboxylation temperature in the &quot;Temper&quot;ture&quot; field.</li>
                    <li>Select the temperature unit (Celsius or Fahrenheit) in the &quot;Temperature&quot;Unit&quot; field.</li>
                    <li>Click the &quot;Calc&quot;late&quot; button to generate the results.</li>
                </ol>

                <p>The tool uses the Arrhenius equation to calculate the rate constant (k) for the decarboxylation reaction, and estimates the time required for the sample to reach the desired percent decarboxylation based on the initial concentration of THCa, decarboxylation efficiency, and heating method.</p>

                <p>Please note that the estimates should be used as guidance rather than concrete values, as the actual time required may be affected by factors such as sample purity, decarboxylation efficiency, and heating method.</p>

                <p>If there are any errors in the input values, such as negative values or empty fields, an error message will be displayed.</p>

            </div> <br>
            <button class="spoiler-btn" onclick="toggleSpoiler('timeFormulas')"><b>Formulas:</b></button>
            <div id="timeFormulas" class="spoiler-content">
                <br>
                <div id="plot"></div>
                <br>
            </div><br>

        </div>
    </div>
</div>


<script>

    function calculateDecarbTime() {
        const sampleSizeInput = document.getElementById("sampleSize");
        const percentDecarboxylationInput = document.getElementById("percentDecarboxylation");
        const temperatureInput = document.getElementById("temperature");
        const thcaConcentrationInput = document.getElementById("thcaConcentration");
        const tempUnitInput = document.getElementById("tempUnit");
        const resultOutput = document.getElementById("decarbTimeResult");

        const sampleSize = sampleSizeInput.value;


        let thcaConcentration = thcaConcentrationInput.value;
        if (thcaConcentration > 1) {
            thcaConcentration = thcaConcentration / 100; // if value greater than 1, convert percent to decimal
        }


        let percentDecarboxylation = percentDecarboxylationInput.value;



        if (percentDecarboxylation > 1) {
            percentDecarboxylation = percentDecarboxylation / 100; // if value greater than 1, convert percent to decimal
            if (percentDecarboxylation >= 0.99) {
                percentDecarboxylation = 0.98;
            }
        }


        const temperature = temperatureInput.value;
        const tempUnit = tempUnitInput.value;

        if (!sampleSize || sampleSize < 0 || !percentDecarboxylation  || !temperature) {
            resultOutput.innerHTML = "<p>Please enter valid input values.</p>";
        } else if (temperature < 80 && tempUnit === "C" || temperature < 176 && tempUnit === "F" || temperature < 353.15 && tempUnit === "K") {
            resultOutput.innerHTML = "<p>Please enter input value higher than 80&#176;C, 176&#176;F, or 353.15K.<br>Note: THCa does not decarboxylate at an accurately or easily quantified rate below these temperatures.</p>";
        } else {
        const decarbTime = predictTime(sampleSize, thcaConcentration, percentDecarboxylation, temperature, tempUnit);
        resultOutput.innerHTML = "<p>Estimated decarboxylation time: " + decarbTime + "</p>";
        }
    }

    function predictTime(sampleSize, thcaConcentration, percentDecarboxylation, temperature, tempUnit) {

        // Calculate Rate Constant
        const rateConstant = calculateRateConstant(temperature,tempUnit);

        // Calculate initial mass of THCA in grams
        const initialMass = sampleSize * thcaConcentration / 1000;

        // Calculate target fraction of THCA
        const targetFraction = 1 - percentDecarboxylation;

        // Calculate decarboxylation time in seconds using Equation 3
        const timeSec = -Math.log(targetFraction) / rateConstant;

        console.log(`It will take ${timeSec} seconds for ${percentDecarboxylation * 100}% decarboxylation of THCa.`);

        return formatDuration(timeSec * 1000);
    }



    function calculateRateConstant(temperature, tempUnit) {
        console.log(`temperature: ${temperature} \n tempUnit: ${tempUnit}`);

        temperature = parseFloat(temperature);

        // Convert temperature to Kelvin if it's not already in Kelvin
        if (tempUnit === "C") {
            temperature = temperature + 273.15; // Celsius to Kelvin conversion
        } else if (tempUnit === "F") {
            temperature = (temperature + 459.67) * (5 / 9); // Fahrenheit to Kelvin conversion
        }

        console.log(`temperature after conversion (in Kelvin): ${temperature}`);

        // Constants for THCA decarboxylation
        const A = 0.41 * Math.pow(10, 5); // Pre-exponential factor in s^-1
        const Ea = 58.7 * 1000; // Activation energy in J/mol
        const R = 8.3145; // Universal gas constant in J/mol*K

        // Calculate the rate constant k using the Arrhenius equation
        const k = A * Math.exp(-Ea / (R * temperature));

        console.log(`k: ${k}`);

        return k;
    }




    function formatDuration(duration) {
        var milliseconds = Math.floor(duration % 1000);
        var seconds = Math.floor((duration / 1000) % 60);
        var minutes = Math.floor((duration / (1000 * 60)) % 60);
        var hours = Math.floor((duration / (1000 * 60 * 60)) % 24);
        var days = Math.floor(duration / (1000 * 60 * 60 * 24));
        var weeks = Math.floor(duration / (1000 * 60 * 60 * 24 * 7));
        var months = Math.floor(duration / (1000 * 60 * 60 * 24 * 30));
        var years = Math.floor(duration / (1000 * 60 * 60 * 24 * 365));

        var parts = [];
        if (years) {
            parts.push(years + ' year' + (years > 1 ? 's' : ''));
        }
        if (months) {
            parts.push(months + ' month' + (months > 1 ? 's' : ''));
        }
        if (weeks) {
            parts.push(weeks + ' week' + (weeks > 1 ? 's' : ''));
        }
        if (days) {
            parts.push(days + ' day' + (days > 1 ? 's' : ''));
        }
        if (hours) {
            parts.push(hours + ' hour' + (hours > 1 ? 's' : ''));
        }
        if (minutes) {
            parts.push(minutes + ' minute' + (minutes > 1 ? 's' : ''));
        }
        if (seconds) {
            parts.push(seconds + ' second' + (seconds > 1 ? 's' : ''));

        }
        if (milliseconds) {
            parts.push(milliseconds + ' millisecond' + (milliseconds > 1 ? 's' : ''));
        }
        if (!parts.length) {
            parts.push('0 milliseconds');
        }
        return parts.join(' ');
    }


</script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>

            // PLOT JS
            const temperatures = Array.from(Array(84), (_, i) => 80 + i * 5);

            const rateConstants = temperatures.map(temp => calculateRateConstant(temp, 'C'));

            if (rateConstants.some(constant => constant === 0)) {
                console.log('Warning: Rate constant is 0 for some temperatures outside the known range');
            }

            const interpTemperatures = [];
            const interpRateConstants = [];

            for (let i = 0; i < temperatures.length - 1; i++) {
                const temp1 = temperatures[i];
                const temp2 = temperatures[i + 1];
                const rateConst1 = rateConstants[i];
                const rateConst2 = rateConstants[i + 1];
                const numInterpPoints = 41;

                for (let j = 0; j < numInterpPoints; j++) {
                    const t = j / (numInterpPoints - 1);
                    const temp = temp1 + t * (temp2 - temp1);
                    const rateConst = rateConst1 + t * (rateConst2 - rateConst1);
                    interpTemperatures.push(temp);
                    interpRateConstants.push(rateConst);
                }
            }

            const experimentalDataTemperatures = [80, 100, 120, 140, 160];
            const experimentalDataConstants = [0.057, 0.376, 0.795, 1.410, 2.819];


            const plotData = [{
                x: interpTemperatures,
                y: interpRateConstants,
                mode: 'lines',
                line: { shape: 'spline', smoothing: 1.5},
                hovertemplate: '<b>Temperature:</b> %{x}&#176;C<br><b>Rate Constant:</b> %{y:.3f} min^-1',
                name: '<b>Interpolated Data</b>'
            }, {
                x: temperatures,
                y: rateConstants,
                mode: 'markers',
                marker: { size: 6 },
                hovertemplate: '<b>Temperature:</b> %{x}&#176;C<br><b>Rate Constant:</b> %{y:.3f} min^-1',
                name: '<b>Arrhenius Data</b>'
            },
                {
                x: experimentalDataTemperatures,
                y: experimentalDataConstants,
                mode: 'markers',
                marker: { size: 10, color: 'red' },
                hovertemplate: '<b>Temperature:</b> %{x}&#176;C<br><b>Rate Constant:</b> %{y:.3f} min^-1',
                name: '<b>Experimental Data</b>'
            }];

            const layout = {
                title: 'Decarboxylation Rate Constants vs Temperature',
                xaxis: { title: 'Temperature (&#176;C)', range: [80, 200] },
                yaxis: { title: 'Rate Constant (min^-1)', type: 'log' },
                hovermode: 'closest',

            };

            const config = {
                modeBarButtonsToAdd: [{
                    name: 'fullscreen',
                    icon: Plotly.Icons.fullscreen,
                    click: function(gd) {
                        Plotly.update(gd, { width: window.screen.width, height: window.screen.height });
                    }
                }]
            };

            Plotly.newPlot('plot', plotData, layout, config);





</script>

<div id="cartridgeIsolateCalculator">
    <h2>Cartridge Isolate Calculator</h2>
    <form id="calcForm">
        <label for="cartCount">Number of Cartridges:</label>
        <input type="number" pattern="[0-9]*" id="cartCount" name="cartCount" required>
        <label for="cartCapacity">Capacity per Cartridge (grams):</label>
        <input type="number" step="0.1" min="0" id="cartCapacity" name="cartWeight" required>
        <label for="cbdPercentage">CBD Percentage:</label>
        <input type="number" step="0.1" min="0" max="100" id="cbdPercentage" name="cbdPercentage" required>
        <label for="thcaPercentage">THC Percentage:</label>
        <input type="number" step="0.1" min="0" max="100" id="thcaPercentage" name="thcaPercentage" required>
        <button type="button" onclick="calculateCartridgeIsolate()">Calculate</button>
    </form>
    <div id="calcResult"></div>
</div>




<script>

    function calculateCartridgeIsolate() {
        const cartCount = document.getElementById("cartCount").valueAsNumber;
        const cartCapacity = document.getElementById("cartCapacity").valueAsNumber;
        const cbdPercentage = document.getElementById("cbdPercentage").valueAsNumber;
        const thcPercentage = document.getElementById("thcaPercentage").valueAsNumber;

        // Validate CBD and THC percentages
        const totalPercentage = cbdPercentage + thcPercentage;
        if (totalPercentage !== 100) {
            const result = document.getElementById("calcResult");
            result.innerHTML = "Error: CBD and THC percentages must add up to 100%";
            return;
        }

        // Validate cart count and capacity
        if (cartCount <= 0 || cartCapacity <= 0) {
            const result = document.getElementById("calcResult");
            result.innerHTML = "Error: Invalid cart count or capacity";
            return;
        }

        // Calculate total weight
        const totalWeight = cartCount * cartCapacity;

        // Calculate THC and THCa amounts based on percentages
        const thcWeight = totalWeight * (thcPercentage / 100);
        const thcaWeight = thcWeight / 0.877;
        const co2Loss = thcaWeight - thcWeight;
        const cbdWeight = totalWeight * (cbdPercentage / 100);

        // Display the results
        const result = document.getElementById("calcResult");
        result.innerHTML =
            "<br><b>THCa Required:</b> " +
            thcaWeight.toFixed(2) +
            " grams<br><b>THC Required:</b> " +
            thcWeight.toFixed(2) +
            " grams<br><b>Decarboxylation Loss (CO2):</b> " +
            co2Loss.toFixed(2) +
            " grams<br><b>CBD Required:</b> " +
            cbdWeight.toFixed(2) +
            " grams";
    }





</script>










<script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>


<script>

    // Tab Javascript & Dark Mode

    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
        setTabContentDarkMode(true);
    }

    function setTabContentDarkMode(isDarkMode) {
        const tabContents = document.getElementsByClassName('tabcontent');
        const tabLinks = document.getElementsByClassName('tablinks');
        for (let i = 0; i < tabContents.length; i++) {
            if (isDarkMode) {
                tabContents[i].classList.add('dark');
                tabLinks[i].classList.add('dark');
            } else {
                tabContents[i].classList.remove('dark');
                tabLinks[i].classList.remove('dark');
            }
        }
    }

    function openTab(evt, tabName) {
        let tabcontent = $(".tabcontent");
        let tablinks = $(".tablinks");

        // close all tabs except for the selected tab
        tabcontent.not(`#${tabName}`).slideUp("fast");

        // toggle the selected tab
        $(`#${tabName}`).slideToggle("fast", function() {
            // after the animation completes, remove "active" class from all tab links
            tablinks.removeClass("active");
        });

        // add "active" class to the selected tab link
        $(evt.currentTarget).toggleClass("active");
    }




</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div id="decarbProgressDisclaimer"><em><br>Note: The results produced by this calculator are an estimate based on the assumption of complete decarboxylation.
    Other factors such as temperature, time, and the starting material may affect the actual result. Please use these estimates as guidance rather than concrete values.</em></div>

<footer>
    <a id="footerLisc" href="#license-modal">Decarboxulator &#169; 2023 &#8212; TheDabCorner LLC.</a>
</footer>

<dialog id="license-modal">
    <button id="closeButton">X</button>
    <h2 style="text-align: center">Fair Source License</h2>
    <p><b>Fair Source License, version 0.9</b><br><br>
        <b>Copyright:</b> &#169; 2023 Jackson Cummings - TheDabCorner LLC<br><br>

        <b>Licensor:</b> <em>Jackson Cummings</em><br><br>

        <b>Software:</b> <em>Decarboxulator - TheDabCorner LLC</em><br><br>

        <b>Use Limitation:</b> <em>1 user</em><br><br>

        <b>License Grant:</b><br> Licensor hereby grants to each recipient of the
        Software (&amp;quo&quot;&quot;you&quot;) a non-exclusive, non-transferable, royalty-free and
        fully-paid-up license, under all of the Licensor's copyright and
        patent rights, to use, copy, distribute, prepare derivative works of,
        publicly perform and display the Software, subject to the Use
        Limitation and the conditions set forth below.<br><br>

        <b>Use Limitation:</b><br> The license granted above allows use by up to the
        number of users per entity set forth above (the &quot;Use Limit&quot;tion&quot;). For
        determining the number of users, &amp;quo&quot;&quot;you&quot; includes all affiliates,
        meaning legal entities controlling, controlled by, or under common
        control with you. If you exceed the Use Limitation, your use is
        subject to payment of Licensor's then-current list price for licenses.<br><br>

        <b>Conditions:</b><br> Redistribution in source code or other forms must include
        a copy of this license document to be provided in a reasonable
        manner. Any redistribution of the Software is only allowed subject to
        this license.<br><br>

        <b>Trademarks:</b><br> This license does not grant you any right in the
        trademarks, service marks, brand names or logos of Licensor.<br><br>

        <b>DISCLAIMER:</b><br> THE SOFTWARE IS PROVIDED &quot;&quot;S IS&quot;, WITHOUT WARRANTY OR
        CONDITION, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO WARRANTIES
        OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
        NON INFRINGEMENT. LICENSORS HEREBY DISCLAIM ALL LIABILITY, WHETHER IN
        AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
        CONNECTION WITH THE SOFTWARE.<br><br>

        <b>Termination:</b><br> If you violate the terms of this license, your rights
        will terminate automatically and will not be reinstated without the
        prior written consent of Licensor. Any such termination will not
        affect the right of others who may have received copies of the
        Software from you.</p>
</dialog>

<script>
    const licenseLink = document.querySelector('a[href="#license-modal"]');
    const licenseModal = document.querySelector('#license-modal');
    const closeBtn = licenseModal.querySelector('button');

    if (!licenseLink) {
        console.error('License link not found.');
    }

    if (!licenseModal) {
        console.error('License modal not found.');
    }


    if (!closeBtn) {
        console.error('Close button not found.');
    }

    licenseLink.addEventListener('click', () => {
        console.log('Opening modal');
        licenseModal.showModal();
    });

    closeBtn.addEventListener('click', () => {
        console.log('Closing modal');
        licenseModal.close();
    });

    licenseModal.addEventListener('click', (event) => {
        if (event.target === licenseModal) {
            console.log('Closing modal');
            licenseModal.close();
        }
    });

</script>


</body>

</html>
